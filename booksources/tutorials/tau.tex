\Level 0 {TAU profiling and tracing}
\index{TAU|(}

TAU~\url{http://www.cs.uoregon.edu/Research/tau/home.php} is a utility
for profiling and tracing your parallel programs. Profiling is the
gathering and displaying of bulk statistics, for instance showing you
which routines take the most time, or whether communication takes a
large portion of your runtime. When you get concerned about
performance, a good profiling tool is indispensible.

Tracing is the construction and displaying of time-dependent
information on  your program run, for instance showing you if one
process lags behind others. For understanding a program's behaviour,
and the reasons behind profiling statistics, a tracing tool can be
very insightful.

TAU works by adding \indexterm{instrumentation} to your code: in
effect it is a source-to-source translator that takes your code and
turns it into one that generates run-time statistics. Doing this
instrumentation is fortunately simple: start by having this code
fragment in your makefile:
\begin{verbatim}
ifdef TACC_TAU_DIR
  CC = tau_cc.sh
else
  CC = mpicc
endif

% : %.c
<TAB>${CC} -o $@ $^
\end{verbatim}

\begin{istc}
To use TAU, do \n{module load tau}. You have to set the environment
variable \n{TAU_TRACE} to~1; it's advisable to set \n{TRACEDIR} to some directory 
for all the TAU output. Likewise set \n{TAU_PROFILE} to~1 and set \n{PROFILEDIR}.
\end{istc}

It is a good move to create a directory for your tracing and profiling
information. You can use two separate directories, but there is no
harm in using the same for both:
\begin{verbatim}
mkdir tau_trace
mkdir tau_profile
export PROFILEDIR=tau_profile
export TRACEDIR=tau_trace

export TAU_PROFILE=1
export TAU_TRACE=1

mpirun myprogram
\end{verbatim}

After this, you view profiling information with \indextermtt{paraprof}
\begin{verbatim}
paraprof tau_profile
\end{verbatim}
Viewing the traces takes a few steps:
\begin{verbatim}
cd tau_trace
rm -f tau.trc tau.edf
tau_treemerge.pl
tau2slog2 tau.trc tau.edf -o yourprogram.slog2 
\end{verbatim}
The \n{slog2} file can then be viewed with \indextermtt{jumpshot}:
\begin{verbatim}
jumpshot yourprogram.slog2
\end{verbatim}

\index{TAU|)}
