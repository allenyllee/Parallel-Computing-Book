% -*- latex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%
%%%% This text file is part of the source of 
%%%% `Introduction to High-Performance Scientific Computing'
%%%% by Victor Eijkhout, copyright 2012-9
%%%%
%%%% This book is distributed under a Creative Commons Attribution 3.0
%%%% Unported (CC BY 3.0) license and made possible by funding from
%%%% The Saylor Foundation \url{http://www.saylor.org}.
%%%%
%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%
%%%% Outlining
%%%%
\OutlineLevelStart0{\chapter{#1}
  \maillink{arabic{chapter} "#1"}{#1}{chapter}
}
\OutlineLevelStart1{\section{#1}
\maillink{\arabic{chapter}.\arabic{section}}{#1}{section}
}
\OutlineLevelCont1{\section{#1}
\maillink{\arabic{chapter}.\arabic{section}}{#1}{section}
}
\OutlineLevelStart2{\subsection{#1}
  \maillink
    {\arabic{chapter}.\arabic{section}.\arabic{subsection}}{#1}{subsection}
}
\OutlineLevelStart3{\subsubsection{#1}}
\setcounter{secnumdepth}{4}
\OutlineLevelStart4{\paragraph{\textit{#1}}}

%%%%
%%%% stuff
%%%%
\newcommand\furtherreading{\Level 0 {Further Reading}\label{sec:furtherreading-\chapshortname}}
\newcommand\heading[1]{\paragraph*{\textbf{#1}}}

{\catcode`\^^I=13 \globaldefs=1
 \newcommand\listing[2]{\begingroup\small\par\vspace{1ex}
  \catcode`\^^I=13 \def^^I{\leavevmode\hspace{40pt}}
  \noindent\fbox{#1}
  \verbatiminput{#2}\endgroup}
 \newcommand\codelisting[1]{\begingroup\small\par\vspace{1ex}
  \catcode`\^^I=13 \def^^I{\leavevmode\hspace{40pt}}
  \noindent\fbox{#1}
  \verbatiminput{#1}\endgroup}
}
\newcommand\inv{^{-1}}\newcommand\invt{^{-t}}
\newcommand\setspan[1]{[\![#1]\!]}
\newcommand\fp[2]{#1\cdot10^{#2}}
\newcommand\fxp[2]{\langle #1,#2\rangle}
\def\n#{\bgroup \catcode`\$=12 \catcode`\_=12 \catcode`\>=12 \catcode`\<=12 \catcode`\#=12
  \catcode`\&=12 \catcode`\^=12 \catcode`\~=12 \def\\{\char`\\}\relax
  \tt \let\next=}

\newcommand\diag{\mathop{\mathrm {diag}}}
\newcommand\argmin{\mathop{\mathrm {argmin}}}
\newcommand\defined{
  \mathrel{\lower 5pt \hbox{${\equiv\atop\mathrm{\scriptstyle D}}$}}}

\newcommand\bbP{\mathbb{P}}
\newcommand\bbR{\mathbb{R}}

\newtheorem{remark}{Remark}
\expandafter\ifx\csname definition\endcsname\relax
    \newtheorem{definition}{Definition}
\fi
\expandafter\ifx\csname theorem\endcsname\relax
    \newtheorem{theorem}{Theorem}
\fi
\expandafter\ifx\csname lemma\endcsname\relax
    \newtheorem{lemma}{Lemma}
\fi

%%%%
%%%% Verbatim source handling
%%%%

% each chapter has a list of sources
\newtoks\chaptersourcelist
\newcommand\addchaptersource[1]{
  \edef\temp{\global\chaptersourcelist={\the\chaptersourcelist #1}}\temp
}
\newcommand\listchaptersources{
  \expandafter\ChapterSourceHeader\the\chaptersourcelist\LSR
  %\tracingmacros=2 \tracingonline=1
  %\texttt{\the\chaptersourcelist}\par
  \expandafter\ListSourcesRecursively\the\chaptersourcelist\LSR
}
\def\LSR{\LSR}
\def\ChapterSourceHeader#1\LSR{
  \def\test{#1\LSR}
  \ifx\test\LSR
  \else
    \Level 0 {Sources used in this chapter}
  \fi
}
\def\ListSourcesRecursively#1{
  \def\test{#1}
  \ifx\test\LSR
  \else
    % list the file
    \textbf{Listing of code #1}:
    {\footnotesize \verbatiminput{#1}}
    \par
    % continue
    \expandafter\ListSourcesRecursively
  \fi
}

\def\verbatimsnippet#1{\verbatiminput{#1}} % snippets/
\newcommand{\cverbatimsnippet}[2][XX]{
  % record this file as bracketed name
  \addchaptersource{{#1}}
  % typeset as nice C code
  \lstset{style=reviewcode,language=C}
  \lstinputlisting{#2}
}
\newcommand{\cxxverbatimsnippet}[2][XX]{
  % record this file as bracketed name
  \addchaptersource{{#1}}
  % typeset as nice C code
  \lstset{style=reviewcode,language=C++}\lstinputlisting{#2}}
\newcommand{\fverbatimsnippet}[2][XX]{
  % record this file as bracketed name
  \addchaptersource{{#1}}
  % typeset as nice Fortran code
  \lstset{style=reviewcode,language=Fortran}
  \lstinputlisting{#2}
}
\def\pverbatimsnippet#1{
  \lstset{style=reviewcode,language=Python}\lstinputlisting{#1}
  \lstset{style=reviewcode,language=C}
}
\newenvironment{clisting}
    {\lstset{style=reviewcode,language=C}\begin{lstlisting}}
    {\end{lstlisting}}
\newenvironment{cxxlisting}
    {\lstset{style=reviewcode,language=C++}\begin{lstlisting}}
    {\end{lstlisting}}
\newenvironment{flisting}
    {\lstset{style=reviewcode,language=Fortran}\begin{lstlisting}}
    {\end{lstlisting}}
\newenvironment{plisting}
    {\lstset{style=reviewcode,language=Python}\begin{lstlisting}}
    {\end{lstlisting}}

\newenvironment{question}{\begin{quotation}\textbf{Question.\ }}{\end{quotation}}
\newenvironment{example}{\begin{quotation}\textbf{Example.\ }}{\end{quotation}}
\newenvironment{fortrannote}
  {\begin{quotation}\noindent\textsl{Fortran note.\kern1em}\ignorespaces}
  {\end{quotation}}
\newenvironment{pythonnote}
  {\begin{quotation}\noindent\textsl{Python note.\kern1em}\ignorespaces}
  {\end{quotation}}
\newenvironment{taccnote}
  {\begin{quotation}\noindent\textsl{TACC note.\kern1em}\ignorespaces}
  {\end{quotation}}

%% \newenvironment{highermath}
%%     {\bigskip\begin{quotation}\noindent\emph{MMM}}
%%     {\end{quotation}\bigskip\noindent\ignorespaces}


\def\chaptertitle{\csname\chaptername title\endcsname}
\def\chaptershorttitle{\csname\chaptername shorttitle\endcsname}

